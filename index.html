<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Giveaway Account ‚Äî Ho√†ng L√¢m</title>

  <!-- ===========================
       STYLES
       ===========================
       - Font: Times New Roman (user requested)
       - Main color palette: greys
       - Layout: 2-column responsive
       - Modern touches: rounded cards, subtle shadows, transitions
  -->
  <style>
    /* ---------------------------
       Base / Reset
       --------------------------- */
    :root{
      --gray-bg: #bfbfbf;
      --panel: #e6e6e6;
      --panel-2: #dcdcdc;
      --muted: #6b6b6b;
      --accent: #8b8b8b;
      --accent-strong: #6a6a6a;
      --success: #2f8f2f;
      --danger: #c04b4b;
      --shadow: 0 6px 24px rgba(0,0,0,0.15);
      --radius: 12px;
    }

    html,body{
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: "Times New Roman", Times, serif;
      background: var(--gray-bg);
      color: #111;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      box-sizing: border-box;
    }

    /* Apply box-sizing globally */
    *, *::before, *::after { box-sizing: inherit; }

    /* Utility classes */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }

    /* ---------------------------
       Page container
       --------------------------- */
    .page {
      max-width: 1100px;
      margin: 28px auto;
      padding: 18px;
      display: grid;
      gap: 20px;
      grid-template-columns: 1fr;
    }

    /* On wide screens make two columns */
    @media(min-width: 860px){
      .page { grid-template-columns: 1fr 420px; }
    }

    /* ---------------------------
       Card style
       --------------------------- */
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.06);
    }

    /* ---------------------------
       Header
       --------------------------- */
    .header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 8px;
    }
    .title {
      display:flex;
      align-items:center;
      gap:10px;
      font-size: 22px;
      font-weight: 700;
    }
    .subtitle {
      color: var(--muted);
      font-size: 13px;
      margin-top: 4px;
    }

    /* ---------------------------
       Left column (main)
       --------------------------- */
    .left {
      display:flex;
      flex-direction: column;
      gap: 12px;
    }

    .input-row {
      display:flex;
      gap: 10px;
      align-items:center;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .input-row input[type="text"]{
      flex: 1 1 320px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.08);
      background: white;
      font-size: 16px;
      color: #111;
      outline: none;
      transition: box-shadow .15s, border-color .15s;
    }
    .input-row input[type="text"]:focus{
      border-color: var(--accent-strong);
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }

    .btn {
      display:inline-block;
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      cursor:pointer;
      transition: transform .08s ease, opacity .12s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn.ghost {
      background: transparent;
      color: var(--accent-strong);
      border: 1px solid rgba(0,0,0,0.06);
    }
    .btn.warn { background: var(--danger); }

    /* ---------------------------
       Result panel (left, below input)
       --------------------------- */
    .result-panel {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      align-items: start;
    }

    .result-inner {
      border-radius: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(0,0,0,0.06);
    }

    .field {
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 0;
    }

    .field-label {
      min-width: 100px;
      font-weight: 700;
      color: #111;
    }

    .field-value {
      flex: 1 1 auto;
      text-align: left;
      color: #111;
      font-weight: 700;
      word-break: break-word;
      padding-right: 8px;
    }

    /* copy / eye buttons in result */
    .small-btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:36px;
      height:36px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.06);
      background: #fff;
      cursor:pointer;
      font-size:16px;
      transition: background .12s;
    }
    .small-btn:hover { background: #f4f4f4; }

    /* loader */
    .loader {
      width: 40px;
      height: 40px;
      border-radius:50%;
      border:5px solid rgba(0,0,0,0.06);
      border-top-color: var(--accent-strong);
      animation: spin 0.9s linear infinite;
      margin: 10px auto;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg);} }

    /* ---------------------------
       Right column (history)
       --------------------------- */
    .right {
      display:flex;
      flex-direction: column;
      gap: 12px;
      min-height: 220px;
    }

    .history-controls {
      display:flex;
      gap: 8px;
      align-items:center;
    }

    .history-controls input[type="search"]{
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.06);
      background: white;
      font-size: 14px;
    }

    .history-list {
      margin-top: 6px;
      padding: 8px;
      border-radius: 8px;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.06);
      max-height: 480px;
      overflow-y: auto;
    }

    .history-item {
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.04);
      margin-bottom: 8px;
      background: #fff;
    }

    .history-item .left {
      flex: 1 1 auto;
      min-width: 0;
    }
    .history-item .left .meta {
      font-weight: 700;
      color: #111;
      margin-bottom: 6px;
      word-break: break-word;
    }
    .history-item .left .sub {
      font-size: 13px;
      color: var(--muted);
    }

    .history-actions {
      display:flex;
      gap: 8px;
      align-items:center;
    }

    .btn-small {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.06);
      background: #f5f5f5;
      cursor: pointer;
      font-size: 13px;
      color: #111;
    }

    /* footer */
    footer {
      margin-top: 18px;
      font-weight: 800;
      text-align:center;
      color: rgba(0,0,0,0.85);
    }

    /* responsive tweaks for very small screens */
    @media(max-width:460px){
      .input-row input[type="text"]{ flex-basis: 100%; }
      .small-btn{ width:34px; height:34px; }
      .page { padding: 8px; }
      .page .card { padding: 12px; }
    }

    /* extra spacing so long code lines in editor remain readable */
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <!-- ===========================
       PAGE WRAPPER
       =========================== -->
  <main class="page" role="main" aria-labelledby="mainTitle">
    <!-- LEFT: Code input + result -->
    <section class="card left" aria-labelledby="leftTitle">
      <div class="header">
        <div>
          <div class="title" id="leftTitle">üéÅ Nh·∫≠p M√£</div>
          <div class="subtitle">Nh·∫≠p m√£ theo d·∫°ng <code>HOANGLAM_xxxx</code></div>
        </div>
        <div aria-hidden="true">
          <!-- space for icon/logo if needed -->
        </div>
      </div>

      <!-- Input row -->
      <div class="input-row" role="form" aria-label="Form nh·∫≠p m√£">
        <input id="codeInput" type="text" inputmode="latin" placeholder="VD: HOANGLAM_3392ijdju2ns" aria-label="Nh·∫≠p m√£" />
        <button id="redeemBtn" class="btn" aria-label="Nh·∫≠n ngay">Nh·∫≠n ngay</button>
        <button id="clearFieldsBtn" class="btn ghost" title="X√≥a tr∆∞·ªùng nh·∫≠p">X√≥a</button>
      </div>

      <!-- Loader -->
      <div id="loader" class="loader" role="status" aria-hidden="true" aria-live="polite">
        <span class="visually-hidden">ƒêang ki·ªÉm tra m√£‚Ä¶</span>
      </div>

      <!-- Result area -->
      <div id="resultPanel" class="result-panel" aria-live="polite">
        <div id="resultBox" class="result-inner" style="display:none;" role="status" aria-label="K·∫øt qu·∫£ t√†i kho·∫£n">
          <div class="field">
            <div class="field-label">T√†i kho·∫£n:</div>
            <div class="field-value" id="usernameVal">‚Äî</div>
            <button class="small-btn" id="copyUserBtn" title="Sao ch√©p username" aria-label="Sao ch√©p username">üìã</button>
          </div>

          <div class="field">
            <div class="field-label">M·∫≠t kh·∫©u:</div>

            <!-- password is displayed masked by default -->
            <div class="field-value" id="passwordVal" style="letter-spacing: 3px;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>

            <!-- eye to toggle visibility -->
            <button class="small-btn" id="togglePassBtn" title="Hi·ªán/·∫©n m·∫≠t kh·∫©u" aria-label="Hi·ªán ho·∫∑c ·∫©n m·∫≠t kh·∫©u">üëÅ</button>

            <!-- copy password actually uses the real value in data attribute -->
            <button class="small-btn" id="copyPassBtn" title="Sao ch√©p m·∫≠t kh·∫©u" aria-label="Sao ch√©p m·∫≠t kh·∫©u">üìã</button>
          </div>

          <!-- extra controls -->
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
            <button id="addNoteBtn" class="btn ghost" title="Ghi ch√∫ (t·∫°m ch·ª©c nƒÉng demo)" aria-label="Ghi ch√∫">Ghi ch√∫</button>
            <button id="openHistoryBtn" class="btn ghost" title="M·ªü l·ªãch s·ª≠" aria-label="M·ªü l·ªãch s·ª≠">M·ªü l·ªãch s·ª≠</button>
          </div>
        </div>
      </div>

      <!-- A small help block -->
      <div style="margin-top:12px;color:var(--muted);font-size:13px;">
        Ghi ch√∫: m√£ ƒë∆∞·ª£c so kh·ªõp kh√¥ng ph√¢n bi·ªát hoa/th∆∞·ªùng. L·ªãch s·ª≠ ƒë∆∞·ª£c l∆∞u tr√™n tr√¨nh duy·ªát v√† ƒë·ªìng b·ªô gi·ªØa c√°c tab.
      </div>
    </section>

    <!-- RIGHT: History / Controls -->
    <aside class="card right" aria-labelledby="rightTitle">
      <div class="header">
        <div>
          <div class="title" id="rightTitle">L·ªãch s·ª≠ ƒë√£ nh·∫≠n</div>
          <div class="subtitle">Danh s√°ch m√£ v√† t√†i kho·∫£n ƒë√£ hi·ªÉn th·ªã</div>
        </div>

        <!-- place for quick action -->
        <div style="display:flex;gap:8px;">
          <button id="exportBtn" class="btn ghost" title="T·∫£i file TXT">üìÅ Xu·∫•t TXT</button>
          <button id="clearHistoryBtn" class="btn warn" title="X√≥a to√†n b·ªô l·ªãch s·ª≠">X√ìA</button>
        </div>
      </div>

      <!-- search -->
      <div class="history-controls" role="search" aria-label="T√¨m l·ªãch s·ª≠">
        <input id="searchInput" type="search" placeholder="T√¨m theo username, code..." aria-label="T√¨m l·ªãch s·ª≠">
      </div>

      <!-- list -->
      <div id="historyList" class="history-list" role="list" aria-label="Danh s√°ch l·ªãch s·ª≠">
        <!-- items injected here -->
      </div>

      <!-- bottom info -->
      <div style="margin-top:12px;color:var(--muted);font-size:13px;">
        V·∫≠n h√†nh b·ªüi <strong>Phan Ho√†ng L√¢m</strong>
      </div>
    </aside>

    <!-- Footer -->
    <footer class="card" style="grid-column: 1 / -1;">
      <div style="display:flex;flex-direction:column;gap:6px;align-items:center;">
        <div style="font-weight:800;">‚ú® Website ƒë∆∞·ª£c l√†m b·ªüi Phan Ho√†ng L√¢m ‚ú®</div>
        <div style="font-size:13px;color:var(--muted);">L∆∞u √Ω: d·ªØ li·ªáu ch·ªâ ƒë∆∞·ª£c l∆∞u tr√™n tr√¨nh duy·ªát, kh√¥ng g·ª≠i server.</div>
      </div>
    </footer>
  </main>

  <!-- ===========================
       JAVASCRIPT - FUNCTIONALITY
       ===========================
       - Clear separation: config, storage, UI helpers, actions, event bindings
       - Many comments so b·∫°n d·ªÖ hi·ªÉu & ch·ªânh s·ª≠a
  -->
  <script>
    /**********************************************************************
     * CONFIG
     * - ACCOUNTS: list of valid codes -> username/password mapping
     *   NOTE: keys are stored in uppercase for case-insensitive comparison
     *********************************************************************/
    const ACCOUNTS = {
      "HOANGLAM_3392IJDJU2NS": { username: "MariotClot", password: "NAMHA123" },
      "HOANGLAM_A7K3M9ZQ":     { username: "LaiT1445",   password: "NAMHA123" },
      "HOANGLAM_Q8Z2P5LM":     { username: "MaMaimn2",   password: "NAMHA123" },
      "HOANGLAM_R4T6W1BX":     { username: "MaMaBay321", password: "NAMHA123" },
      "HOANGLAM_YU72BF9K":     { username: "KatuRuler9x",password: "NAMHA123" },
      "HOANGLAM_12XK9VRC":     { username: "Coconutne89",password: "NAMHA123" }
    };

    /* Storage keys */
    const STORAGE_HISTORY_KEY = 'giveaway_history_v2';
    const STORAGE_THEME_KEY = 'giveaway_theme_v2'; // not used but reserved for future

    /* DOM references (cache) */
    const dom = {
      codeInput: document.getElementById('codeInput'),
      redeemBtn: document.getElementById('redeemBtn'),
      clearFieldsBtn: document.getElementById('clearFieldsBtn'),
      loader: document.getElementById('loader'),
      resultBox: document.getElementById('resultBox'),
      usernameVal: document.getElementById('usernameVal'),
      passwordVal: document.getElementById('passwordVal'),
      copyUserBtn: document.getElementById('copyUserBtn'),
      copyPassBtn: document.getElementById('copyPassBtn'),
      togglePassBtn: document.getElementById('togglePassBtn'),
      addNoteBtn: document.getElementById('addNoteBtn'),
      openHistoryBtn: document.getElementById('openHistoryBtn'),

      // history
      searchInput: document.getElementById('searchInput'),
      historyList: document.getElementById('historyList'),
      exportBtn: document.getElementById('exportBtn'),
      clearHistoryBtn: document.getElementById('clearHistoryBtn')
    };

    /**********************************************************************
     * State
     *********************************************************************/
    let state = {
      shownPassword: false, // whether password in result is visible
      current: { username: '', password: '', code: '' }, // currently displayed account
      history: [] // array of { time, code, username, password }
    };

    /**********************************************************************
     * STORAGE HELPERS
     *********************************************************************/
    function loadHistoryFromStorage(){
      try {
        const raw = localStorage.getItem(STORAGE_HISTORY_KEY);
        if(!raw) return [];
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed)) return parsed;
        return [];
      } catch(err) {
        console.warn('Failed to load history:', err);
        return [];
      }
    }

    function saveHistoryToStorage(historyArr){
      try {
        localStorage.setItem(STORAGE_HISTORY_KEY, JSON.stringify(historyArr));
      } catch(err) {
        console.warn('Failed to save history:', err);
      }
    }

    /**********************************************************************
     * UTILITIES
     *********************************************************************/
    function toKey(txt){
      if(!txt) return '';
      return String(txt).trim().toUpperCase();
    }

    function nowStr(){
      return new Date().toLocaleString();
    }

    async function copyToClipboard(text){
      try {
        await navigator.clipboard.writeText(String(text));
        showToast('ƒê√£ sao ch√©p v√†o clipboard');
        return true;
      } catch(e){
        // fallback older browsers
        try {
          const ta = document.createElement('textarea');
          ta.value = String(text);
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          ta.remove();
          showToast('ƒê√£ sao ch√©p v√†o clipboard');
          return true;
        } catch(e2) {
          showToast('Kh√¥ng th·ªÉ sao ch√©p');
          return false;
        }
      }
    }

    /* toast small messages */
    function showToast(msg, timeout=1200){
      // simple approach: create ephemeral element
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed';
      t.style.right = '18px';
      t.style.top = '18px';
      t.style.zIndex = 9999;
      t.style.background = 'rgba(0,0,0,0.8)';
      t.style.color = '#fff';
      t.style.padding = '8px 12px';
      t.style.borderRadius = '8px';
      t.style.fontWeight = 700;
      t.style.fontSize = '13px';
      document.body.appendChild(t);
      setTimeout(()=> { t.style.opacity = '0'; t.style.transition = 'opacity .3s'; }, timeout - 280);
      setTimeout(()=> { t.remove(); }, timeout);
    }

    /**********************************************************************
     * RENDER HISTORY LIST
     * - include per-item actions (show/hide password, copy, delete)
     * - supports search filter
     *********************************************************************/
    function renderHistoryList(){
      const list = state.history || [];
      const q = (dom.searchInput.value || '').toLowerCase().trim();

      // clear
      dom.historyList.innerHTML = '';

      if(list.length === 0){
        const p = document.createElement('div');
        p.style.padding = '12px';
        p.style.color = 'var(--muted)';
        p.textContent = 'Ch∆∞a c√≥ l·ªãch s·ª≠';
        dom.historyList.appendChild(p);
        return;
      }

      // iterate & create items
      list.forEach((entry, idx) => {
        // search filter
        const serialized = `${entry.time} ${entry.code} ${entry.username} ${entry.password}`.toLowerCase();
        if(q && !serialized.includes(q)) return;

        const item = document.createElement('div');
        item.className = 'history-item';
        item.setAttribute('role', 'listitem');

        // left meta
        const left = document.createElement('div');
        left.className = 'left';

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `${entry.time} ‚Äî ${entry.code}`;

        const sub = document.createElement('div');
        sub.className = 'sub';
        // mask the password in list initially
        const masked = maskPassword(entry.password);
        sub.textContent = `${entry.username}  |  Pass: ${masked}`;

        left.appendChild(meta);
        left.appendChild(sub);

        // right actions
        const actions = document.createElement('div');
        actions.className = 'history-actions';

        // show/hide button
        const showBtn = document.createElement('button');
        showBtn.className = 'btn-small';
        showBtn.title = 'Hi·ªán/·∫®n m·∫≠t kh·∫©u';
        showBtn.textContent = 'HI·ªÜN';
        showBtn.addEventListener('click', () => {
          if(showBtn.textContent === 'HI·ªÜN'){
            sub.textContent = `${entry.username}  |  Pass: ${entry.password}`;
            showBtn.textContent = '·∫®N';
          } else {
            sub.textContent = `${entry.username}  |  Pass: ${maskPassword(entry.password)}`;
            showBtn.textContent = 'HI·ªÜN';
          }
        });

        // copy button (copies username and password)
        const copyBtn = document.createElement('button');
        copyBtn.className = 'btn-small';
        copyBtn.title = 'Copy username & password';
        copyBtn.textContent = 'COPY';
        copyBtn.addEventListener('click', async () => {
          await copyToClipboard(`${entry.username}\t${entry.password}`);
        });

        // delete single item
        const delBtn = document.createElement('button');
        delBtn.className = 'btn-small';
        delBtn.style.background = '#ffecec';
        delBtn.style.borderColor = 'rgba(0,0,0,0.06)';
        delBtn.textContent = 'X√ìA';
        delBtn.title = 'X√≥a m·ª•c n√†y';
        delBtn.addEventListener('click', () => {
          if(!confirm('X√≥a m·ª•c n√†y kh·ªèi l·ªãch s·ª≠?')) return;
          removeHistoryAtIndex(idx);
        });

        actions.appendChild(showBtn);
        actions.appendChild(copyBtn);
        actions.appendChild(delBtn);

        item.appendChild(left);
        item.appendChild(actions);

        dom.historyList.appendChild(item);
      });
    }

    function maskPassword(p){
      if(!p) return '‚Äî';
      const len = Math.max(3, Math.min(6, p.length));
      return '*'.repeat(len) + (p.length > len ? '...' : '');
    }

    /**********************************************************************
     * MUTATION: add/remove history
     *********************************************************************/
    function addHistory(entry){
      // entry = { time, code, username, password }
      state.history.unshift(entry); // newest first
      // cap to some reasonable number
      if(state.history.length > 500) state.history.length = 500;
      saveHistoryToStorage(state.history);
      // trigger re-render + storage sync (other tabs will pick up via storage event)
      renderHistoryList();
    }

    function removeHistoryAtIndex(idx){
      // idx corresponds to index in the current state.history
      if(idx < 0 || idx >= state.history.length) return;
      state.history.splice(idx, 1);
      saveHistoryToStorage(state.history);
      renderHistoryList();
      // Also notify other tabs by touching localStorage key
      localStorage.setItem(STORAGE_HISTORY_KEY, JSON.stringify(state.history));
    }

    function clearAllHistory(){
      if(!confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) return;
      state.history = [];
      saveHistoryToStorage(state.history);
      // notify other tabs
      localStorage.setItem(STORAGE_HISTORY_KEY, JSON.stringify(state.history));
      renderHistoryList();
      showToast('ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠');
    }

    /**********************************************************************
     * ACTION: Redeem code (main flow)
     * - shows loader
     * - checks ACCOUNTS (case-insensitive)
     * - if matched: display, add to history
     * - else: show error toast
     *********************************************************************/
    function redeemCode(){
      const raw = dom.codeInput.value || '';
      const key = toKey(raw);
      if(!key){
        showToast('Vui l√≤ng nh·∫≠p m√£');
        return;
      }

      // show loader
      dom.loader.style.display = 'block';
      dom.resultBox.style.display = 'none';

      // simulate small delay to show loader (real app could call server)
      setTimeout(() => {
        dom.loader.style.display = 'none';
        // find entry in ACCOUNTS (keys stored uppercase in config)
        const matchedKey = Object.keys(ACCOUNTS).find(k => toKey(k) === key);
        if(!matchedKey){
          showToast('M√£ kh√¥ng h·ª£p l·ªá');
          return;
        }

        const acc = ACCOUNTS[matchedKey];
        // update state.current
        state.current = { username: acc.username, password: acc.password, code: matchedKey };

        // show values
        dom.usernameVal.textContent = acc.username;
        dom.passwordVal.textContent = maskPassword(acc.password); // masked by default
        dom.passwordVal.dataset.real = acc.password; // store real password in data attribute
        state.shownPassword = false;
        dom.resultBox.style.display = 'block';

        // add to history
        const entry = {
          time: nowStr(),
          code: matchedKey,
          username: acc.username,
          password: acc.password
        };
        addHistory(entry);

        // clear input
        dom.codeInput.value = '';
      }, 850);
    }

    /**********************************************************************
     * Toggle result password visibility
     *********************************************************************/
    function toggleResultPassword(){
      const real = dom.passwordVal.dataset.real || '';
      if(!real) return;
      if(state.shownPassword){
        // hide it
        dom.passwordVal.textContent = maskPassword(real);
        state.shownPassword = false;
      } else {
        dom.passwordVal.textContent = real;
        state.shownPassword = true;
      }
    }

    /**********************************************************************
     * Export history as .txt
     * - generates a textual content with each line "time ‚Äî code ‚Äî username / password"
     * - downloads as accounthoanglam.txt
     *********************************************************************/
    function exportHistoryAsTxt(){
      const arr = state.history || [];
      if(arr.length === 0){
        showToast('Kh√¥ng c√≥ l·ªãch s·ª≠ ƒë·ªÉ xu·∫•t');
        return;
      }
      const lines = arr.map(it => `${it.time} ‚Äî ${it.code} ‚Äî ${it.username} / ${it.password}`);
      const content = lines.join('\n');
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'accounthoanglam.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('B·∫Øt ƒë·∫ßu t·∫£i accounthoanglam.txt');
    }

    /**********************************************************************
     * HANDLE storage event for multi-tab sync
     *********************************************************************/
    window.addEventListener('storage', (ev) => {
      // when STORAGE_HISTORY_KEY changes, reload history from localStorage
      if(ev.key === STORAGE_HISTORY_KEY){
        state.history = loadHistoryFromStorage();
        renderHistoryList();
      }
      // theme key reserved for future
    });

    /**********************************************************************
     * EVENT BINDINGS
     *********************************************************************/
    function bindUI(){
      // redeem on click & Enter key
      dom.redeemBtn.addEventListener('click', redeemCode);
      dom.codeInput.addEventListener('keydown', (e) => {
        if(e.key === 'Enter') redeemCode();
      });

      // clear fields button
      dom.clearFieldsBtn.addEventListener('click', () => {
        dom.codeInput.value = '';
        dom.codeInput.focus();
      });

      // copy buttons
      dom.copyUserBtn.addEventListener('click', () => {
        const t = dom.usernameVal.textContent || '';
        if(t && t !== '‚Äî') copyToClipboard(t);
      });
      dom.copyPassBtn.addEventListener('click', () => {
        const real = dom.passwordVal.dataset.real || '';
        if(real) copyToClipboard(real);
      });

      // toggle password in result
      dom.togglePassBtn.addEventListener('click', toggleResultPassword);

      // open history (scroll into view)
      dom.openHistoryBtn.addEventListener('click', () => {
        dom.historyList.scrollIntoView({ behavior: 'smooth' });
      });

      // add note (demo)
      dom.addNoteBtn.addEventListener('click', () => {
        const note = prompt('Ghi ch√∫ nhanh (tu·ª≥ ch·ªçn):');
        if(note) showToast('Ghi ch√∫: ' + note);
      });

      // search filter
      dom.searchInput.addEventListener('input', () => {
        renderHistoryList();
      });

      // export & clear history
      dom.exportBtn.addEventListener('click', exportHistoryAsTxt);
      dom.clearHistoryBtn.addEventListener('click', clearAllHistory);
    }

    /**********************************************************************
     * INITIALIZATION
     *********************************************************************/
    function init(){
      // load persisted history
      state.history = loadHistoryFromStorage();
      // render initially
      renderHistoryList();
      // bind events
      bindUI();
      // focus input
      dom.codeInput.focus();
    }

    // run init
    init();

    /**********************************************************************
     * End of script
     *********************************************************************/
  </script>
</body>
</html>
